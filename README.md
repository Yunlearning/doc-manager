# å››éšæ–‡ä»¶ç®¡ç†ç³»çµ± (Four-Tier Document Management System)

ä¸€å€‹æ”¯æ´ ISO 27001ã€ISO 9001 ç­‰å¤šç¨®é©—è­‰æ¨™æº–çš„å››éšæ–‡ä»¶ç®¡ç†å¹³å°ï¼Œå…·å‚™å®Œæ•´çš„èªè­‰æˆæ¬Šèˆ‡æ¬Šé™ç®¡ç†æ©Ÿåˆ¶ã€‚

## åŠŸèƒ½ç‰¹è‰²

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¢ **å¤šå°ˆæ¡ˆç®¡ç†** â€” å¯å»ºç«‹ä¸åŒé©—è­‰æ¨™æº–çš„å°ˆæ¡ˆï¼ˆISO 27001ã€ISO 9001 ç­‰ï¼‰
- ğŸŒ³ **å››éšæ¨¹ç‹€çµæ§‹** â€” è¦–è¦ºåŒ–çš„å››éšæ–‡ä»¶å±¤ç´šï¼ˆå“è³ªæ‰‹å†Š â†’ ç¨‹åºæ›¸ â†’ ä½œæ¥­æŒ‡å°æ›¸ â†’ è¡¨å–®/ç´€éŒ„ï¼‰
- ğŸ“¤ **éåŒæ­¥ä¸Šå‚³** â€” é€é BullMQ + Redis ä½‡åˆ—å¯¦ç¾éé˜»å¡æª”æ¡ˆä¸Šå‚³
- ğŸ“¥ **ä¸²æµä¸‹è¼‰** â€” ä½¿ç”¨ Node.js Stream å¯¦ç¾éé˜»å¡æª”æ¡ˆä¸‹è¼‰
- ğŸ”„ **å³æ™‚åˆ‡æ›** â€” Dashboard å¿«é€Ÿåˆ‡æ›ä¸åŒå°ˆæ¡ˆ
- âœ… **è¡¨å–®é©—è­‰** â€” å‰å¾Œç«¯çš†ä½¿ç”¨ Zod é€²è¡Œè³‡æ–™é©—è­‰

### æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†ï¼ˆVersion Table Strategyï¼‰
- ğŸ“‹ **ç‰ˆæœ¬æ­·å²** â€” æ¯æ¬¡ä¸Šå‚³è‡ªå‹•å»ºç«‹ç‰ˆæœ¬è¨˜éŒ„ï¼Œä¿ç•™å®Œæ•´æ­·å²
- âª **ç‰ˆæœ¬é‚„åŸ** â€” ä¸€éµé‚„åŸè‡³ä»»æ„æ­·å²ç‰ˆæœ¬ï¼ˆå»ºç«‹æ–°ç‰ˆæœ¬ï¼Œä¸ç ´å£æ­·å²ï¼‰
- ğŸ“ **è®Šæ›´æ—¥èªŒ** â€” æ¯æ¬¡ä¸Šå‚³å¯å¡«å¯« changelog èªªæ˜è®Šæ›´å…§å®¹
- ğŸ‘¤ **ä¸Šå‚³è¿½è¹¤** â€” è¨˜éŒ„æ¯å€‹ç‰ˆæœ¬çš„ä¸Šå‚³è€…è³‡è¨Š

### èªè­‰èˆ‡æˆæ¬Š
- ğŸ” **JWT èªè­‰** â€” å®‰å…¨çš„ Token é©—è­‰æ©Ÿåˆ¶
- ğŸ‘¥ **è§’è‰²ç®¡ç†** â€” Adminï¼ˆç®¡ç†å“¡ï¼‰èˆ‡ Userï¼ˆä¸€èˆ¬ç”¨æˆ¶ï¼‰
- ğŸ”‘ **æ¬Šé™æ§åˆ¶** â€” ç´°ç²’åº¦æ¬Šé™ï¼ˆä¸Šå‚³ã€ä¸‹è¼‰ã€å»ºç«‹å°ˆæ¡ˆã€åˆªé™¤æ–‡ä»¶ï¼‰
- ğŸ›¡ï¸ **OWASP åˆè¦** â€” bcrypt å¯†ç¢¼åŠ å¯†ã€ç™»å…¥éŒ¯èª¤æ¬¡æ•¸é™åˆ¶ã€å¸³è™Ÿé–å®š
- ğŸ“Š **ç™»å…¥è¿½è¹¤** â€” è¨˜éŒ„ IPã€ä½ç½®ã€æ™‚é–“ã€ç€è¦½å™¨è³‡è¨Š
- ğŸ¨ **ä¸»é¡Œåˆ‡æ›** â€” æ”¯æ´æš—è‰²/äº®è‰²/ç³»çµ±é è¨­ä¸»é¡Œ

### ç®¡ç†åŠŸèƒ½
- ğŸ‘¤ **å€‹äººè³‡æ–™** â€” ä¿®æ”¹å§“åã€è®Šæ›´å¯†ç¢¼ã€æŸ¥çœ‹ç™»å…¥æ­·å²
- ğŸ”§ **ç”¨æˆ¶ç®¡ç†** â€” ç®¡ç†å“¡å¯ç·¨è¼¯ç”¨æˆ¶æ¬Šé™ã€åœç”¨å¸³è™Ÿã€æŸ¥çœ‹ç™»å…¥ç´€éŒ„

## æŠ€è¡“å †ç–Š

| å±¤é¢ | æŠ€è¡“ |
|------|------|
| **å¾Œç«¯** | Node.js + TypeScript + Express |
| **è³‡æ–™åº«** | PostgreSQL 15 + Prisma ORM |
| **ä½‡åˆ—** | BullMQ + Redis 7 |
| **èªè­‰** | JWT + bcrypt |
| **å®‰å…¨** | Helmet + Rate Limiting |
| **å‰ç«¯** | Next.js 16 + TypeScript + Material UI v7 |
| **ç‹€æ…‹ç®¡ç†** | React Context API |
| **é©—è­‰** | Zod (å‰å¾Œç«¯å…±ç”¨) |
| **æ¸¬è©¦** | Jest + Supertest |
| **å®¹å™¨** | Docker Compose |

## å¿«é€Ÿé–‹å§‹

### 1. å•Ÿå‹• PostgreSQL & Redis

```bash
docker-compose up -d
```

### 2. è¨­å®šå¾Œç«¯

```bash
cd backend
npm install

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
npx prisma migrate dev

# å»ºç«‹æ¸¬è©¦è³‡æ–™ï¼ˆ2 å€‹ç”¨æˆ¶ + ISO 27001 å°ˆæ¡ˆ + 4 éšæ–‡ä»¶ï¼‰
npx prisma db seed

# å•Ÿå‹•å¾Œç«¯
npm run dev
```

å¾Œç«¯å•Ÿå‹•æ–¼ http://localhost:3001

### 3. è¨­å®šå‰ç«¯

```bash
cd frontend
npm install
npm run dev
```

å‰ç«¯å•Ÿå‹•æ–¼ http://localhost:3000

### 4. ç™»å…¥æ¸¬è©¦

é–‹å•Ÿ http://localhost:3000/loginï¼Œä½¿ç”¨ä»¥ä¸‹æ¸¬è©¦å¸³è™Ÿï¼š

| è§’è‰² | Email | å¯†ç¢¼ | æ¬Šé™ |
|------|-------|------|------|
| ç®¡ç†å“¡ | admin@docmgr.com | Admin@123 | å®Œæ•´æ¬Šé™ |
| ä¸€èˆ¬ç”¨æˆ¶ | user@docmgr.com | User@123 | åƒ…å”¯è®€ |

## API ç«¯é»

### èªè­‰ (`/api/auth`)

| æ–¹æ³• | ç«¯é» | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| POST | `/auth/register` | è¨»å†Šæ–°ç”¨æˆ¶ | å…¬é–‹ |
| POST | `/auth/login` | ç™»å…¥ï¼ˆé™åˆ¶ 5 æ¬¡/15 åˆ†é˜ï¼‰ | å…¬é–‹ |
| GET | `/auth/me` | å–å¾—ç•¶å‰ç”¨æˆ¶è³‡è¨Š | éœ€ç™»å…¥ |
| PUT | `/auth/profile` | æ›´æ–°å€‹äººè³‡æ–™ | éœ€ç™»å…¥ |
| PUT | `/auth/password` | è®Šæ›´å¯†ç¢¼ | éœ€ç™»å…¥ |
| GET | `/auth/login-logs` | å–å¾—ç™»å…¥æ­·å² | éœ€ç™»å…¥ |

### ç®¡ç†å“¡ (`/api/admin`)

| æ–¹æ³• | ç«¯é» | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| GET | `/admin/users` | å–å¾—æ‰€æœ‰ç”¨æˆ¶ | Admin |
| PUT | `/admin/users/:id/permissions` | ç·¨è¼¯ç”¨æˆ¶æ¬Šé™ | Admin |
| PATCH | `/admin/users/:id/toggle` | åœç”¨/å•Ÿç”¨ç”¨æˆ¶ | Admin |
| GET | `/admin/users/:id/login-logs` | æŸ¥çœ‹ç”¨æˆ¶ç™»å…¥ç´€éŒ„ | Admin |

### å°ˆæ¡ˆ (`/api/projects`)

| æ–¹æ³• | ç«¯é» | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| GET | `/projects` | å–å¾—æ‰€æœ‰å°ˆæ¡ˆ | éœ€ç™»å…¥ |
| POST | `/projects` | å»ºç«‹å°ˆæ¡ˆ | CREATE_PROJECT |
| GET | `/projects/:id` | å–å¾—å°ˆæ¡ˆè©³æƒ… | éœ€ç™»å…¥ |
| PUT | `/projects/:id` | æ›´æ–°å°ˆæ¡ˆ | CREATE_PROJECT |
| DELETE | `/projects/:id` | åˆªé™¤å°ˆæ¡ˆ | CREATE_PROJECT |
| GET | `/projects/:id/tree` | å–å¾—å››éšæ¨¹ç‹€çµæ§‹ | éœ€ç™»å…¥ |

### éšå±¤ (`/api/tiers`)

| æ–¹æ³• | ç«¯é» | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| GET | `/tiers?projectId=` | å–å¾—éšå±¤åˆ—è¡¨ | éœ€ç™»å…¥ |
| POST | `/tiers` | å»ºç«‹éšå±¤ç¯€é» | CREATE_PROJECT |
| PUT | `/tiers/:id` | æ›´æ–°éšå±¤ç¯€é» | CREATE_PROJECT |
| DELETE | `/tiers/:id` | åˆªé™¤éšå±¤ç¯€é» | CREATE_PROJECT |

### æ–‡ä»¶ (`/api/documents`)

| æ–¹æ³• | ç«¯é» | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| POST | `/documents/upload` | ä¸Šå‚³æ–‡ä»¶ï¼ˆæ”¯æ´æ–°ç‰ˆæœ¬ä¸Šå‚³ï¼‰ | UPLOAD |
| GET | `/documents?tierId=` | å–å¾—éšå±¤ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ | éœ€ç™»å…¥ |
| GET | `/documents/jobs/:jobId` | æŸ¥è©¢ä¸Šå‚³é€²åº¦ | éœ€ç™»å…¥ |
| GET | `/documents/:id/versions` | å–å¾—æ–‡ä»¶ç‰ˆæœ¬æ­·å² | éœ€ç™»å…¥ |
| POST | `/documents/:id/revert` | é‚„åŸè‡³æŒ‡å®šç‰ˆæœ¬ | UPLOAD |
| GET | `/documents/:id/download` | ä¸‹è¼‰æ–‡ä»¶ï¼ˆä¸²æµï¼‰ | DOWNLOAD |
| DELETE | `/documents/:id` | åˆªé™¤æ–‡ä»¶ï¼ˆå«æ‰€æœ‰ç‰ˆæœ¬ï¼‰ | DELETE_DOCUMENT |

## æ¬Šé™ç³»çµ±

| æ¬Šé™ | èªªæ˜ |
|------|------|
| `UPLOAD` | ä¸Šå‚³æ–‡ä»¶è‡³ä»»æ„éšå±¤ |
| `DOWNLOAD` | ä¸‹è¼‰æ–‡ä»¶æª”æ¡ˆ |
| `CREATE_PROJECT` | å»ºç«‹å°ˆæ¡ˆã€æ–°å¢/ä¿®æ”¹éšå±¤çµæ§‹ |
| `DELETE_DOCUMENT` | åˆªé™¤æ–‡ä»¶ |

> **æ³¨æ„**ï¼šAdmin è§’è‰²æ“æœ‰æ‰€æœ‰æ¬Šé™ï¼Œä¸€èˆ¬ç”¨æˆ¶é è¨­ç‚ºå”¯è®€ï¼ˆåƒ…èƒ½ç€è¦½å°ˆæ¡ˆèˆ‡æ–‡ä»¶åˆ—è¡¨ï¼‰ã€‚

## æ¸¬è©¦

```bash
cd backend
npm test
```

## ç‰ˆæœ¬ç®¡ç†æ¶æ§‹

æœ¬ç³»çµ±æ¡ç”¨ **Version Table Strategy**ï¼Œå°‡æ–‡ä»¶èˆ‡ç‰ˆæœ¬åˆ†é›¢å„²å­˜ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Document        â”‚       â”‚    DocumentVersion       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id                  â”‚â”€â”€â”    â”‚ id                       â”‚
â”‚ tierId              â”‚  â”‚    â”‚ documentId (FK)          â”‚
â”‚ title               â”‚  â””â”€â”€â”€â–¶â”‚ versionNumber            â”‚
â”‚ currentVersion (int)â”‚       â”‚ title / fileName / filePath â”‚
â”‚ uploadedById        â”‚       â”‚ mimeType / fileSize      â”‚
â”‚ createdAt / updatedAtâ”‚      â”‚ changelog                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ uploadedById             â”‚
                              â”‚ createdAt                â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¨­è¨ˆåŸå‰‡ï¼š**
- `Document` ç‚ºè¼•é‡ç´šæŒ‡æ¨™ï¼Œåƒ…è¨˜éŒ„ç›®å‰ç‰ˆæœ¬è™Ÿ
- æ‰€æœ‰æª”æ¡ˆè³‡è¨Šï¼ˆè·¯å¾‘ã€å¤§å°ã€é¡å‹ï¼‰å­˜æ–¼ `DocumentVersion`
- é‚„åŸæ“ä½œå»ºç«‹æ–°ç‰ˆæœ¬ï¼ˆä¸ç ´å£æ­·å²ç´€éŒ„ï¼‰
- ä¸Šå‚³æ–°ç‰ˆæœ¬æ™‚è‡ªå‹•éå¢ `currentVersion` ä¸¦å»ºç«‹æ–° `DocumentVersion`

## å°ˆæ¡ˆçµæ§‹

```
doc-manger/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma      # è³‡æ–™åº« Schemaï¼ˆUser, Document, DocumentVersion ç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ seed.ts            # æ¸¬è©¦è³‡æ–™ç¨®å­
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ config/            # DB & Redis è¨­å®š
â”‚   â”‚   â”œâ”€â”€ routes/            # API è·¯ç”±ï¼ˆauth, admin, projects, tiers, documentsï¼‰
â”‚   â”‚   â”œâ”€â”€ controllers/       # è«‹æ±‚è™•ç†
â”‚   â”‚   â”œâ”€â”€ services/          # æ¥­å‹™é‚è¼¯ï¼ˆauthService, documentService ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ queues/            # BullMQ ä½‡åˆ—
â”‚   â”‚   â”œâ”€â”€ jobs/              # éåŒæ­¥å·¥ä½œï¼ˆuploadWorker â€” æ”¯æ´é¦–æ¬¡ä¸Šå‚³èˆ‡æ–°ç‰ˆæœ¬ä¸Šå‚³ï¼‰
â”‚   â”‚   â”œâ”€â”€ middlewares/       # ä¸­ä»‹å±¤ï¼ˆauthenticate, rateLimiter, errorHandlerï¼‰
â”‚   â”‚   â””â”€â”€ validators/        # Zod é©—è­‰
â”‚   â”œâ”€â”€ storage/documents/     # æœ¬åœ°æª”æ¡ˆå„²å­˜
â”‚   â””â”€â”€ __tests__/             # Jest æ¸¬è©¦
â””â”€â”€ frontend/
    â””â”€â”€ src/
        â”œâ”€â”€ app/               # Next.js é é¢ï¼ˆlogin, profile, admin, dashboardï¼‰
        â”œâ”€â”€ components/        # React å…ƒä»¶ï¼ˆHeader, DocumentTree, DocumentTableï¼‰
        â”œâ”€â”€ contexts/          # Context APIï¼ˆAuthContext, ThemeContextï¼‰
        â”œâ”€â”€ hooks/             # SWR è³‡æ–™ Hook
        â”œâ”€â”€ lib/               # API å®¢æˆ¶ç«¯ï¼ˆaxios + JWT interceptorï¼‰
        â”œâ”€â”€ types/             # TypeScript å‹åˆ¥ï¼ˆUser, DocumentItem, DocumentVersionï¼‰
        â””â”€â”€ validators/        # Zod é©—è­‰
```

## ç’°å¢ƒè®Šæ•¸

### Backend (`.env`)

```env
DATABASE_URL="postgresql://postgres:password@localhost:5433/docmgr?schema=public"
REDIS_HOST=localhost
REDIS_PORT=6379
JWT_SECRET=your-super-secret-jwt-key-change-in-production
PORT=3001
```

## å®‰å…¨æ€§

- âœ… **å¯†ç¢¼åŠ å¯†**ï¼šä½¿ç”¨ bcrypt (salt rounds: 10)
- âœ… **JWT Token**ï¼šæœ‰æ•ˆæœŸ 7 å¤©
- âœ… **ç™»å…¥é™åˆ¶**ï¼š5 æ¬¡éŒ¯èª¤å¾Œé–å®šå¸³è™Ÿ
- âœ… **Rate Limiting**ï¼š15 åˆ†é˜å…§æœ€å¤š 5 æ¬¡ç™»å…¥å˜—è©¦
- âœ… **Helmet**ï¼šè¨­å®šå®‰å…¨ HTTP headers
- âœ… **è¼¸å…¥é©—è­‰**ï¼šå‰å¾Œç«¯çš†ä½¿ç”¨ Zod é©—è­‰

## æˆæ¬Šæ¢æ¬¾

MIT License
